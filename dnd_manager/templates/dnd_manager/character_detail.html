{% extends 'dnd_manager/base.html' %}

{% block subnav %}
<div class="bg-light border-bottom py-2">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="{% url 'campaign_list' %}">All Campaigns</a></li>
        <li class="breadcrumb-item">
          <a href="{% url 'campaign_detail' pk=campaign.id %}">{{ campaign.name }}</a>
        </li>
        <li class="breadcrumb-item">
          <a href="{% url 'character_list' campaign_id=campaign.id %}">Characters</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
          {{ character.name }}
        </li>
      </ol>
    </nav>
  </div>
</div>
{% endblock subnav %}

{% block content %}
  <h1 class="mb-4">{{ character.name }}</h1>
  <div class="row">
    <!-- Left column: image & basic info -->
    <div class="col-md-4">
      {% if character.character_image %}
        <img src="{{ character.character_image.url }}" alt="Character Image" class="img-fluid img-thumbnail mb-3" />
      {% else %}
        <div class="text-muted">No image provided.</div>
      {% endif %}
      <p>
        <strong>Player:</strong> {{ character.player_name }}<br>
        <strong>Class:</strong> {{ character.class_type }}<br>
        <strong>Level:</strong> {{ character.level }}<br>
        <strong>Race:</strong> {{ character.race }}
      </p>
    </div>

    <!-- Right column: backstory, stats -->
    <div class="col-md-8">
      <div class="mb-3">
        <strong>Backstory:</strong>
        <p class="ms-3">{{ character.backstory|linebreaks }}</p>
      </div>

      <!-- Ability scores in two columns -->
      <div class="row">
        <div class="col-sm-6">
          <p><strong>STR:</strong> {{ character.strength }}</p>
          <p><strong>DEX:</strong> {{ character.dexterity }}</p>
          <p><strong>CON:</strong> {{ character.constitution }}</p>
        </div>
        <div class="col-sm-6">
          <p><strong>INT:</strong> {{ character.intelligence }}</p>
          <p><strong>WIS:</strong> {{ character.wisdom }}</p>
          <p><strong>CHA:</strong> {{ character.charisma }}</p>
        </div>
      </div>

      <div class="mb-3">
        <p><strong>Max HP:</strong> {{ character.max_hit_points }}</p>
        <p><strong>Current HP:</strong> {{ character.current_hit_points }}</p>
        <p><strong>Armor Class:</strong> {{ character.armor_class }}</p>
      </div>
      <p><strong>Gold:</strong> {{ character.gold }} GP</p>
    </div>
  </div>

  <div class="mb-5">
    <a class="btn btn-primary" href="{% url 'character_update' campaign_id=campaign.id pk=character.id %}">Edit</a>
    <a class="btn btn-danger" href="{% url 'character_delete' campaign_id=campaign.id pk=character.id %}">
      Delete
    </a>
    <a class="btn btn-secondary" href="{% url 'character_list' campaign_id=campaign.id %}">
      Back
    </a>
  </div>

  <div class="col-md-6">
    <!-- Inventory (Items) -->
    <h3>Items / Inventory</h3>
    {% if items_owned %}
      <ul class="list-group mb-3">
        {% for item in items_owned %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <strong>{{ item.name }}</strong>
            {% if item.item_type %}
              <small class="text-muted"> - {{ item.item_type }}</small>
            {% endif %}
            <br>
            <small>{{ item.description|truncatechars:80 }}</small>
            <br>
            <small class="text-muted">Price: {{ item.price }} gp</small>
          </div>

          <a href="{% url 'item_update' campaign_id=campaign.id character_id=character.id pk=item.pk %}">Edit</a>

          <div class="d-flex align-items-center">
            <!-- Show item rarity as a color-coded badge -->
            <span 
              class="badge me-2
                {% if item.rarity == 'Legendary' %}bg-danger
                {% elif item.rarity == 'Rare' %}bg-primary
                {% elif item.rarity == 'Uncommon' %}bg-success
                {% else %}bg-secondary
                {% endif %}
              "
            >
              {{ item.rarity }}
            </span>
      
            <!-- Action Buttons -->
            <div class="btn-group">
              <!-- Delete Item -->
              <a 
                href="{% url 'item_delete' campaign_id=campaign.id character_id=character.id pk=item.pk %}" 
                class="btn btn-sm btn-danger"
              >
                Delete
              </a>
              <!-- Sell Item -->
              <a 
                href="" 
                class="btn btn-sm btn-warning"
              >
                Sell
              </a>
              <!-- Transfer Item -->
              <a 
                href="" 
                class="btn btn-sm btn-secondary"
              >
                Transfer
              </a>
            </div>
          </div>
        </li>
      {% endfor %}
      </ul>
    {% else %}
      <div class="text-muted">No items owned.</div>
    {% endif %}

    <!-- Link to create a new item for this character -->
    <a href="{% url 'item_create' campaign_id=campaign.id character_id=character.id %}" 
       class="btn btn-primary">
      Add Item
    </a>
  </div>

{% endblock content %}
